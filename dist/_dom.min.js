const _dom=function(){const e={};{class r{constructor(e,t){this._catcher=e,this._args=t,this._data=null}get result(){return this._data?this._data.value:void 0}set result(e){this.touch(),this._data.value=e}get method(){return this._catcher.method}get arguments(){return this._args.slice(0)}get args(){return this._args.slice(0)}get untouched(){return!this._data}touch(){this._data||(this._data={})}apply(e){return this.result=this._catcher.callMethod(e)}flush(){return this.apply(this.arguments)}pipe(e){return this.result=e[this.method].apply(e,this.args)}}e["CatchMethod.js"]={CatchMethod:class{constructor(e,t,s){if(!e.constructor||!e.constructor.prototype||"function"!=typeof e.constructor.prototype[t])throw console.error("----------_dom.catchMethod Error"),console.log("target:",e),["","_dom.catchMethod Error:",'The target dont have a constructor prototype with a method "'+t+'".'].join("\n");this.target=e,this.method=t,this.callback=s,this.proto=e.constructor.prototype,this.attached=!1}callMethod(e){return this.proto[this.method].apply(this.target,e)}fork(e){}attach(){if(!this.attached){this.attached=!0;const s=this;this.target[this.method]=(...e)=>{e=new r(s,e);let t=s.callback(e);return void 0===t&&(e.untouched&&e.flush(),t=e.result),t}}return this}detach(){return this.attached&&(this.attached=!1,this.target[this.method]=this.proto[this.method].bind(this.target)),this}}}}e["DomCore.js"]={DomCore:class{constructor(){}static get uid(){return Date.now().toString(16)+"-"+Math.floor(1e12*Math.random()).toString(16)}static dom(e,t,s,r){let o=arguments,n;try{n="string"==typeof r?document.createElementNS(r,e):document.createElement(e),!s&&t instanceof Array&&(s=t,t={});let o=function(e,t,s){if(void 0===e)throw"property '"+s+"' doesn't exist.";for(var r in t)"object"==typeof t[r]?o(e[r],t[r],s+"."+r):e[r]=t[r]};o(n,t,(""+e).toUpperCase()),this.append(n,s)}catch(e){throw console.error("----------_dom Error"),console.log("arguments=",o),console.log("error=",e),"_dom Error:\n"+e}return n}static append(e,s){if(!(e instanceof HTMLElement))throw"_dom.append Error:\nparameter dom must be a dom element.";if(s&&"number"==typeof s.length)if("string"==typeof s)e.innerHTML+=s;else for(let t=0;t<s.length;t++)if("string"==typeof s[t])e.appendChild(document.createTextNode(s[t]));else try{e.appendChild(s[t])}catch(e){throw console.error("-----------------------"),console.log("childs["+t+"]=",s[t]),console.log("error=",e),"_dom.append Error:\nparameter childs["+t+"] must be string or dom element."}}static findParent(t,s,r=10){var e=[];if(t instanceof HTMLElement||e.push('arg[0] "dom" is not an HTMLElement.'),"function"!=typeof s&&e.push('arg[1] "condition" is not a function.'),("number"!=typeof r||r<2)&&e.push('arg[2] "maxDeep" is not a number with a value > 1 ."'),e.length)throw console.error("----------_dom.findParent Error"),console.log("arguments=",arguments),"\n_dom.findParent Error:\n"+e.map(e=>"\t- "+e).join("\n");for(let e=0;e<r&&t.parentNode;e++){if(s(t))return t;t=t.parentNode}}static events(s,e){(e instanceof Array?e:[e]).forEach(t=>{(t.type instanceof Array?t.type:[t.type]).forEach(e=>s.addEventListener(t.type,t.callback))})}static objName2tagName(e){return e.split(/([A-Z])/).map((e,t)=>t%2?"-"+e.toLowerCase():e).join("")}static tagName2objName(e){return e.split(/-([a-zA-Z])/).map((e,t)=>t%2?e.toUpperCase():e).join("")}static pre_thow(e,t,s={}){t=t instanceof Array?t:[t];Object.keys(s);return console.error("----------_dom."+e+" Error"),Object.keys(s).forEach(e=>{console.log(e+" = ",s[e])}),["","_dom."+e+" Error:",...t].join("\n")}}};{const s=e["DomCore.js"]["DomCore"];class o{constructor(){}static defaultCssRef=new Map;static get sheet(){return 0==document.styleSheets.length&&document.documentElement.appendChild(s.dom("style",[""])),document.styleSheets[document.styleSheets.length-1]}static rule(e,t,s,o,n){if("string"!=typeof e||!e.length)throw console.error("----------_dom.rule Error"),console.log("selector=",e),"\n_dom.rule Error:\nselector is not a valid css query.";(s=s instanceof CSSStyleSheet?s:this.sheet).insertRule(e+"{\n\n}",s.cssRules.length);let i=s.cssRules[s.cssRules.length-1];if(t){let r=(e,t)=>{for(var s in e)"object"==typeof e[s]?(i.appendRule(s+"{\n\n}"),r(e[s],i.cssRules[i.cssRules.length-1])):t.style[s]=e[s],o&&s in n&&(o[n[s]]=o[s])};r(t,i)}return i}static rules(e,t,s=""){let r="";s&&(e={["."+(r=s+"-"+DomTools.uid)]:e});var o,n={},i=this.getRulesData(e);for(o in t instanceof CSSStyleSheet||(t=this.sheet),i.rules){try{n[o]=this.rule(o,i.rules[o],t,n,i.alias)}catch(e){console.warn('_dom.rules Warning:\nInsertion of rule "'+o+'" failed!\n\n'+e)}o in i.alias&&(n[i.alias[o]]=n[o])}return r?{className:r,rules:n}:n}static getRulesData(e){function c(r,o,t,n){let e={},i;t.length&&(i=t.join(""));for(let s in r){var a=s.charAt(0);if("$"===a)o[s.substr(1)]=r[s];else if("@"===a){var l={rules:{}};c(r[s],Object.assign({},o),[],l),n.rules[s]=l.rules}else if(t.length&&"&"!==a)if("alias"===s)u.alias[i]=r[s];else{let t=r[s]+"";Object.keys(o).forEach(e=>{t=-1<t.indexOf(e)?t.split(e).join(o[e]):t}),e[s]=t}else(t.length?s.substr(1):s).split(",").forEach(e=>{c(r[s],Object.assign({},o),t.concat([e]),n||u)})}i&&(n.rules[i]?Object.assign(u.rules[i],e):n.rules[i]=e)}let u={rules:{},alias:{}};return c(e,{},[]),u}static defaultCss(e,t=!1){let o,n;if(e=(e=e instanceof HTMLElement?(o=e).tagName:e).toLowerCase(),t||o||!this.defaultCssRef.has(e)){let s,r=document.documentElement;try{s=document.createElement(e),r.appendChild(s);let t=window.getComputedStyle(s);n=new Map,Object.keys(t).map(e=>t[e]).filter(e=>"-"!==e.charAt(0)&&""!==t[e]).forEach(e=>n.set(e,t[e])),o||this.defaultCssRef.set(e,n),r.removeChild(s)}catch(e){throw s&&s.parentNode&&r.removeChild(s),"\n_dom.properties Error:\n"+e}}else n=this.defaultCssRef.get(e);return n}}e["DomCss.js"]={DomRules:class{constructor(){}},DomCss:o}}{class n{constructor(e,t=""){this.prefix=(t="object"!=typeof t?{prefix:(t||"")+""}:t).prefix||"",this.defaultValue=t.defaultValue||"",this.initValue=t.initValue||"",this.map=new Map}get themes(){return Array.from(this.map.keys())}clone(){var e=new a({prefix:this.prefix,defaultValue:this.defaultValue,initValue:this.initValue});return e._priv.map=new Map(this.map),e}get(e){return this.map.get(e)}add(e,t={}){this.map.set(e,t)}addData(e){for(var t in e)this.add(t,e[t])}extract(){const t={};return this.themes.forEach(e=>{t["&."+this.prefix+e]=this.map.get(e)}),t}extractRoot(e){return{[e]:this.extract()}}filterStatus(e,t=!1){return this.map.has(e)?e:t&&this.map.has(this.initValue)?this.initValue:this.map.has(this.defaultValue)?this.defaultValue:""}attach(e,t=""){return new i(this,e,this.filterStatus(t,!0))}}class i{constructor(e,t,s=""){this.domstat=e,this.target=t,this.prefix=e.prefix,this._current=this._status=s,this.update()}get status(){return this._status}set status(e){this.select(e)}update(){this.domstat.themes.forEach(e=>{e===this._status?this.target.classList.add(this.prefix+e):this.target.classList.remove(this.prefix+e)})}select(e,t=!1){e=this.domstat.filterStatus(e);t=t||this._status!==e;this._status=e,t&&this.update()}}class a{constructor(e=""){this._priv=new n(this,e)}get themes(){return this._priv.themes}clone(){return this._priv.clone()}get(e){return this._priv.get(e)}add(e,t={}){return this._priv.add(e,t),this}addData(e){return this._priv.addData(e),this}extract(){return this._priv.extract()}extractRoot(e){return this._priv.extractRoot(e)}attach(e,t=""){return this._priv.attach(e,t)}}e["DomCssStatus.js"]={DomCssStatus:a}}e["settings.js"]={debug:!1,modelref:"__dom",moduleref:"__module__"};{const l=e["settings.js"]["modelref"],c=e["DomCss.js"]["DomCss"];class u{constructor(e,t){Object.defineProperty(this,"tagName",{get:function(){return e.tagName}}),e.cssRules&&(s=e.getRules(),Object.defineProperty(this,"rules",{get:function(){return s}})),Object.defineProperty(this,"services",{get:function(){return e.module.servicesProxy}});var s,r=e.constructor.apply(this,t);if(!(r instanceof HTMLElement))throw console.error("-----------------------"),console.log("tagName=",e.tagName),console.log("constructor=",e.constructor),console.log("this.dom=",r),"\n_dom.model Error:\nconstructor must return an HTMLElement.";r[l]&&(this._super=r[l]),"dom"in this||Object.defineProperty(this,"dom",{get:function(){return r}})}}e["DomModel.js"]={DomModel:class{constructor(e,t,s,r){let o;this.module=e,this.tagName=t,this.constructor=s,this.cssRules="function"==typeof r?r:"object"==typeof r?function(){return r}:0,this.getRules=function(e){return o=this.cssRules&&!o?c.rules(this.cssRules()):o}}build(e){var t=this.instance(e);return Object.defineProperty(t.dom,l,{get:function(){return t},configurable:!0}),t.dom}instance(e){return new u(this,e)}}}}{class h{constructor(e,t){this._priv={service:e,args:t}}get module(){return this._priv.service.domModule}get arguments(){return this._priv.args}get services(){return this._priv.service.domModule.servicesProxy}}e["DomService.js"]={DomService:class{constructor(e,t,s,r){this.domModule=e,this.name=t,this._constructor=s,this.args=r,this._instance=null,this._services=null}get instance(){if(!this._instance){let e;if(this.args instanceof Array?e=this.args:"function"==typeof this.args&&(e=this.args()),!(e instanceof Array))throw console.error('----------_dom.service["'+this.name+'"] Error'),console.log("args =",this.args),console.log("result =",e),'\n_dom.service Error:\n "args" must be an array or a function returning an array.';this._instance=new this._constructor(new h(this.domModule,e))}return this._instance}},DomServicesProxy:class{constructor(e){this._priv={services:null},this.module=e}get services(){return this._services||(this._priv.services=new Proxy({},{get:(e,t)=>{var s=this.module.getService(t,!0);if(s)return s;throw console.error("-----------------------"),console.log("tagName\t=",tagName),console.log("service name\t=",t),'\n_dom.model.services Error:\nservice "'+t+'" not found.'}})),this._priv.services}}}}{const d=e["DomCore.js"]["DomCore"],m=e["settings.js"]["modelref"],f=new Map;e["DomShadow.js"]={DomShadow:class p{constructor(o,e,t,n){var s,r=o.attachShadow({mode:"open"}),i=(n=n||[],t.slice(1).map((e,t)=>{let s,r=t+1;if(o.hasAttribute(e))if(s=o.getAttribute(e),"function"==typeof n[r])s=n[r](s);else if("boolean"===n[r])s=!["false","0","off"].includes(s)&&!!s.length;else if("int"===n[r])s=parseInt(s);else if("number"===n[r])s=parseFloat(s);else if("function"===n[r])s=new Function(""+s).bind(o);else if("string"!==n[r])try{s=JSON.parse(s)}catch(e){}return s})),e=(t=[e].concat(i),_dom.apply(null,t)),a=(r.appendChild(e),[]),l=e[m].rules;for(s in l)a.push(l[s].cssText);r.appendChild(_dom("style",{type:"text/css",textContent:a.join("\n")}))}static modelShadowed(e){return f.has(e)}static modelShadow(s,r,o){if(!this.modelShadowed(r)){if(!s.hasModel(r))throw["","_dom.modelShadow Error:",'argument[0] "tagName"="'+r+'" has no model declared.'].join("\n");{s.rootModule,s.getModel(r),s=d.tagName2objName(r);let e=(_models[r].constructor+"").split(")",2)[0].split("(")[1].split(","),t=e.map(e=>o.hasOwnProperty(e)?o[e]:0);class i extends HTMLElement{constructor(){super(),new p(this,r,e,t)}}var n={name:s,[s]:class extends i{}};f.set(r,n),customElements.define(r,n[s])}}}}}}{class g{}g.scroll={offset:function(t,s,r){if(t.contains(s)){r="number"==typeof r?[r,r]:r instanceof Array?[0,1].map(e=>r[e]||0):[0,0];var o=[0,0];let e=s;for(;e!==t;)o[0]+=e.offsetWidth,o[1]+=e.offsetHeight,e=e.parentNode;return o.map((e,t)=>e-r[t])}throw console.error("----------_dom.scrollTo Error"),console.log("container=",t),console.log("target=",s),"_dom.scrollOffset Error: target not found in container"},value:function(e,t,s){const r=[e.scrollLeft,e.scrollTop];return this.offset(e,t,s).map((e,t)=>Math.max(0,e-r[t]))},to:function(e,t,s){t=this.value(e,t,s);e.scrollTop=t[0],e.scrollLeft=t[1]}},e["DomUtils.js"]={DomUtils:g}}{const v=e["settings.js"]["moduleref"],_=e["DomCss.js"]["DomCss"],y=e["DomShadow.js"]["DomShadow"],w=e["DomCssStatus.js"]["DomCssStatus"],b=e["DomCore.js"]["DomCore"],M=e["DomUtils.js"]["DomUtils"],S=e["CatchMethod.js"]["CatchMethod"];e["_dom.builder.js"]=function(o){function e(e,t,s,r){return o.make(e,t,s,r)}return Object.defineProperty(e,v,{value:o,writable:!1,enumerable:!1}),Object.defineProperty(e,"moduleName",{get:()=>o.name}),Object.defineProperty(e,"uid",{get:()=>b.uid}),Object.defineProperty(e,"models",{get:()=>o.availableModels}),Object.defineProperty(e,"sheet",{get:()=>_.sheet}),Object.defineProperty(e,"services",{get:()=>o.servicesProxy}),e.append=function(e,t){b.append(e,t)},e.model=function(e,t,s,r){return o.model(e,t,s,r)},e.addService=function(e,t,s){return o.addService(e,t,s)},e.has=function(e){return o.hasModel(e)},e.instance=function(e,t){return o.instance(e,t)},e.findParent=function(e,t,s=10){return b.findParent(e,t,s)},e.events=function(e,t){return b.events(e,t)},e.defaultCss=function(e,t=!1){return _.defaultCss(e,t)},e.rule=function(e,t,s){return _.rule(e,t,s)},e.rules=function(e,t,s=""){return _.rules(e,t,s)},e.modelShadowed=function(e){return y.modelShadowed(e)},e.modelShadow=function(e,t){return y.modelShadow(o,e,t)},e.module=function(e){return o.module(e)._dom},e.export=function(e){return o.export(e)._dom},e.import=function(e){o.import(e)},e.cssStatus=function(e=""){return new w(e)},e.scrollTo=function(e,t,s){M.scroll.to(e,t,s)},e.catchMethod=function(e,t,s){return new S(e,t,s).attach()},e}}{const j=e["settings.js"]["moduleref"],E=e["_dom.builder.js"],D=e["DomCore.js"]["DomCore"],x=e["DomModel.js"]["DomModel"],C=e["DomShadow.js"]["DomShadow"],{DomService:N,DomServicesProxy:P}=e["DomService.js"];let t=null,s=1;e["DomModule.js"]={DomModule:class O{constructor(e){t=t||this,this.id=s++,this.name=e||"mod_module_"+this.id,this.models=new Map,this.publicModels=new Map,this.services=new Map,this.publicServices=new Map,this.modules=[],this._dom=E(this),this.parent=null,this._servicesProxy=new P(this)}static get rootModule(){return t}get rootModule(){return t}get availableModels(){const t=[];return this.modules.forEach(e=>t.push(...e.availableModels)),t.concat(Array.from(this.publicModels.keys()))}get availableServices(){const t=[];return this.modules.forEach(e=>t.push(...e.availableServices)),t.concat(Array.from(this.publicServices.keys()))}get parentPile(){return this.parent?this.parent.pile:[]}get pile(){return this.parent?[this].concat(this.parent.pile):[this]}get servicesProxy(){return this._servicesProxy.services}findModule(e){if(e(this))return this;for(var t of this.modules)if(t=t.findModule(e))return t}module(e){return new O(e)}clone(e=null,t=null){e=e||{};var s=new O;return s.parent=t,s.models=new Map(e.models||this.models),s.publicModels=new Map(e.publics||this.publicModels),s.publicServices=new Map(e.publicServices||this.publicServices),s.modules=this.modules.map(e=>e.clone(null,this)),s}export(e,t=[]){var s,r,o={models:e,services:t};for(s in o){var n=o[s];if(console.log(n instanceof Array,n.every(e=>"string"==typeof e)),!(n instanceof Array&&n.every(e=>"string"==typeof e)))throw D.pre_thow("export",['argument "'+s+'" Must be an array of strings.'],{[s]:n})}if(!(e.length+t.length))throw D.pre_thow("export",["cant export a module with no public declarations."],{models:e,services:t});if((r=e.filter(e=>!this.hasModel(e))).length)throw D.pre_thow("export",["Some models are not found."],{models:e,"not found":r,availables:this.availableModels});if((r=t.filter(e=>!this.hasService(e))).length)throw D.pre_thow("export",["Some services are not found."],{services:t,"not found":r,availables:this.availableServices});let i={publics:new Map,publicServices:new Map};return e.forEach(e=>i.publics.set(e,!0)),t.forEach(e=>i.publicServices.set(e,!0)),this.clone(i)}import(e){const s=[];var t=(e instanceof Array?e:[e]).map((e,t)=>e instanceof O?e:e&&e[j]instanceof O?e[j]:void s.push(t));if(s.length)throw console.error("----------_dom.import Error"),console.log("domModules=",e),"\n_dom.import Error:\ndomModules not importables at indexes ("+s.join(" ,")+" ) .";let r=this.parentPile;t.map(s=>{if(this.id===s.id)throw'\n_dom.import Error:\nModule "'+fm.name+'" cant import Himself.';if(this.modules.find(e=>e.id===s.id))throw'\n_dom.import Error:\nModule "'+fm.name+'" allready in "'+this.name+'" collection.';r.map(t=>{if(s.findModule(e=>e.id===t.id))throw console.error("----------_dom.import Error"),console.log("domModules=",e),'\n_dom.import Error:\nCyclic reference for module "'+s.name+'".'}),this.modules.push(s.clone(null,this))})}addService(e,t,s){t=new N(this,e,t,s),this.services.set(e,t),this.publicServices.set(e,!0)}hasService(t){return!(!this.publicServices.has(t)&&!this.modules.find(e=>e.hasService(t)))}getService(e,t=!1){return this.publicServices.has(e)||t&&this.services.has(e)?this.services.get(e).instance:this.modules.find(e=>e.getService(tagName))||null}hasModel(t){return!(!this.publicModels.has(t)&&!this.modules.find(e=>e.hasModel(t)))}getModel(t){return this.publicModels.has(t)?this.models.get(t):this.modules.find(e=>e.getModel(t))||null}instance(e,t){if(this.hasModel(e))return this.getModel(e).instance(arguments);throw console.error("----------_dom.instance Error"),console.log("arguments=",arguments),'\n_dom.instance Error:\ntagName "'+e+'" not found in models.'}make(e,t,s,r){var o=arguments;return this.hasModel(e)?this.getModel(e).build(o):D.dom(e,t,s,r)}model(e,t,s,r){if(-1===e.indexOf("-")&&console.warn('_dom.model suspect tagName "'+e+'" should contain at least one "-" to avoid conflict with natives HTMLElements.'),this.models.has(e)||this.hasModel(e))throw'\n_dom.model Error:\ntagName "'+e+'" allready exists in this module.';if("function"!=typeof t)throw console.error("----------_dom.model Error"),console.log("tagName=",e),console.log("constructor=",t),"\n_dom.model Error:\nconstructor must be a function.";this.models.set(e,new x(this,e,t,s)),this.publicModels.set(e,!0),r&&C.modelShadow(this,e,r)}}}}var t;return t=e["DomModule.js"].DomModule,e["_dom.js"]=(new t)._dom,e["_dom.js"]}();try{module.exports=_dom}catch(e){}
//# sourceMappingURL=_dom.js.map